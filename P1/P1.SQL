ALTER TABLE EMPLOYEE_EXPENSETYPE DROP CONSTRAINT FK_REQUESTING_EMP;
ALTER TABLE LOGIN DROP CONSTRAINT FK_LOGIN;
DROP SEQUENCE SQ_EMP_ID;
DROP TABLE EMPLOYEE_EXPENSETYPE;
DROP TABLE LOGIN;
DROP TABLE EXPENSETYPE;
DROP TABLE EMPLOYEE;


--TABLES

CREATE TABLE EMPLOYEE (
    DEPT_ID NUMBER(4),
    FNAME VARCHAR2(50),
    LNAME VARCHAR2(50),
    EMP_MGR_ID NUMBER(4),
    EMP_EMAIL VARCHAR2(50) NOT NULL
    );
/

CREATE TABLE EXPENSETYPE (
    EXP_ID NUMBER(2) PRIMARY KEY,
    EXP_NAME VARCHAR2(25)
);
/

CREATE TABLE EMPLOYEE_EXPENSETYPE AS
    SELECT EXP_ID FROM EXPENSETYPE;
/
ALTER TABLE EMPLOYEE_EXPENSETYPE
    ADD EMP_ID NUMBER(4);
/

ALTER TABLE EMPLOYEE_EXPENSETYPE
    ADD IMG BLOB;
 ALTER TABLE EMPLOYEE_EXPENSETYPE
    ADD APPROVING_MGR NUMBER;
ALTER TABLE EMPLOYEE_EXPENSETYPE
    ADD EXP_DT DATE DEFAULT SYSDATE;
COMMIT;    
/

--CONSTRAINTS

ALTER TABLE EMPLOYEE_EXPENSETYPE
ADD CONSTRAINT FK_TYPEID
    FOREIGN KEY (EXP_ID) REFERENCES EXPENSETYPE(EXP_ID) ON DELETE CASCADE;
/

CREATE TABLE LOGIN (
    USERNAME VARCHAR2(20) DEFAULT 0 NOT NULL,
    PASS VARCHAR2(20) DEFAULT 0 NOT NULL,
    EMP_ID NUMBER(4) DEFAULT 0 NOT NULL
    );

/
ALTER TABLE LOGIN
ADD CONSTRAINT PK_LOGIN
PRIMARY KEY (USERNAME, PASS);
/
ALTER TABLE EMPLOYEE
    ADD EMP_ID NUMBER(4)
    CONSTRAINT PK_EMP PRIMARY KEY NOVALIDATE;
    COMMIT;
/
ALTER TABLE LOGIN
ADD CONSTRAINT FK_LOGIN
    FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID);
/
ALTER TABLE EMPLOYEE
ADD CONSTRAINT FK_MGR
    FOREIGN KEY (EMP_MGR_ID)REFERENCES EMPLOYEE (EMP_ID);
/
ALTER TABLE EMPLOYEE_EXPENSETYPE
ADD CONSTRAINT FK_REQUESTING_EMP
    FOREIGN KEY (EMP_ID) REFERENCES EMPLOYEE(EMP_ID) ON DELETE CASCADE;
/

--SEQUENCE TO CREATE EMP_ID

CREATE SEQUENCE SQ_EMP_ID

/
--  This is where i need to work on next: making the sequence loop!!!************



    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'DAVID', 'HIGGINS', 1, 'SRTUSA1@RALLY.COM', SQ_EMP_ID.nextval);
        
        COMMIT;
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'PATRIK', 'SANDELL', 1, 'SANDELL18@RALLY.COM', SQ_EMP_ID.nextval);
       
        COMMIT;
        
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'SAM', 'ALBERT', 1, 'SAMALBERT@RALLY.COM', SQ_EMP_ID.nextval);
    
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'MICHELLE', 'MILLER', 1, 'MMILLERRACING@RALLY.COM', SQ_EMP_ID.nextval);
        
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
         VALUES (1, 'PER', 'ALMKVIST', 1, '18CODRIVER@RALLY.COM', SQ_EMP_ID.nextval);
         
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'CRAIG', 'DREW', 1, '75CODRIVER@RALLY.COM', SQ_EMP_ID.nextval);
        
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'TRAVIS', 'PASTRANA', 1, 'TRAVISP@RALLY.COM', SQ_EMP_ID.nextval);
        
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'ROBBIE', 'DURANT', 1, 'PASTRANACODRIVER@RALLY.COM', SQ_EMP_ID.nextval);
        
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'JEFF', 'SEEHORN', 1, 'SEEHORN@RALLY.COM', SQ_EMP_ID.nextval);
            
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES (1, 'KAREN', 'JANKOWSKI', 1, 'SEEHORNCODRIVER@RALLY.COM', SQ_EMP_ID.nextval);
    
    INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES ( 1, 'OLIVER', 'SOLBERG', 1, 'IAMJUSTAKID@RALLY.COM', SQ_EMP_ID.nextval);

COMMIT;
/

CREATE OR REPLACE TRIGGER TR_NEWHIRE
BEFORE INSERT ON EMPLOYEE
    FOR EACH ROW
    BEGIN
        SELECT SQ_EMP_ID.NEXTVAL INTO: NEW.EMP_ID FROM DUAL;
    END;
/
 INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES ( 1, 'CRASHTEST', 'DUMMY', 1, 'DUMMY@RALLY.COM', SQ_EMP_ID.nextval);

 INSERT INTO EMPLOYEE(DEPT_ID, FNAME, LNAME,EMP_MGR_ID, EMP_EMAIL, EMP_ID)
        VALUES ( 1, 'RACECAR', 'DRIVER', 1, 'DRIVER@RALLY.COM', SQ_EMP_ID.nextval);
/
COMMIT;
/
--INSERT EXPENSE INSTANCES USING SEQUENCE FOR ID

INSERT ALL
    INTO EXPENSETYPE(EXP_ID, EXP_NAME) VALUES(1, 'CAR PARTS')
    INTO EXPENSETYPE(EXP_ID, EXP_NAME) VALUES(2, 'FUEL')
    INTO EXPENSETYPE(EXP_ID, EXP_NAME) VALUES(3, 'RACE ENTRY FEES')
    INTO EXPENSETYPE(EXP_ID, EXP_NAME) VALUES(4, 'GEAR')
    INTO EXPENSETYPE(EXP_ID, EXP_NAME) VALUES(5, 'OTHER')
SELECT * FROM DUAL;
/

INSERT ALL 
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(2,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(1,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(3,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(5,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(6,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(7,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(8,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(9,1,3)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(10,1,2)
    INTO EMPLOYEE_EXPENSETYPE (EMP_ID, APPROVING_MGR, EXP_ID) VALUES(1,1,1)
SELECT * FROM DUAL;

ALTER TABLE EMPLOYEE_EXPENSETYPE
    ADD CONSTRAINT PK_E_ETYPE
    PRIMARY KEY (EMP_ID, EXP_ID, EXP_DT);
/
    COMMIT;
    
    